import{r as C,a as x,b as r,o as y,c as V,w as l,d as _,e,j as R,F as z,f as H,g as S,E as A,i as j,u as f,k as E}from"./index-kcIMNLtE.js";import{b as K,c as I,d as M}from"./datasource-ADxuvDjp.js";import{b as B}from"./database-RDrguITP.js";import{u as G}from"./index-HVbNK4wK.js";const J={__name:"add-or-update",emits:["refreshDataList"],setup(O,{expose:d,emit:N}){const U=N,c=C(!1),g=C(),t=x({id:"",dbType:"",connName:"",url:"",driverClassName:"",databaseId:"",username:"",password:"",databaseName:""}),v=C([]),h=()=>{B().then(o=>{v.value=o.data})},L=o=>{let a=v.value.filter(p=>p.dbType===o)[0];t.url=a.url,t.driverClassName=a.driverClassName,t.databaseId=a.id},k=o=>{c.value=!0,t.id="",g.value&&g.value.resetFields(),o&&b(o)},b=o=>{K(o).then(a=>{Object.assign(t,a.data)})},s=C({dbType:[{required:!0,message:"必填项不能为空",trigger:"blur"}],connName:[{required:!0,message:"必填项不能为空",trigger:"blur"}],url:[{required:!0,message:"必填项不能为空",trigger:"blur"}],username:[{required:!0,message:"必填项不能为空",trigger:"blur"}],password:[{required:!0,message:"必填项不能为空",trigger:"blur"}],databaseName:[{required:!0,message:"必填项不能为空",trigger:"blur"}]}),T=()=>{g.value.validate(o=>{if(!o)return!1;I({...t}).then(()=>{A.success({message:"操作成功",duration:500,onClose:()=>{c.value=!1,U("refreshDataList")}})})})};return d({init:k}),(o,a)=>{const p=r("el-input"),i=r("el-form-item"),q=r("el-option"),m=r("el-select"),D=r("el-form"),w=r("el-button"),F=r("el-dialog");return y(),V(F,{modelValue:c.value,"onUpdate:modelValue":a[9]||(a[9]=n=>c.value=n),title:t.id?"修改":"新增","close-on-click-modal":!1},{footer:l(()=>[e(w,{onClick:a[7]||(a[7]=n=>c.value=!1)},{default:l(()=>[_("取消")]),_:1}),e(w,{type:"primary",onClick:a[8]||(a[8]=n=>T())},{default:l(()=>[_("确定")]),_:1})]),default:l(()=>[e(D,{ref_key:"dataFormRef",ref:g,model:t,rules:s.value,"label-width":"120px",onKeyup:a[6]||(a[6]=R(n=>T(),["enter"]))},{default:l(()=>[e(i,{label:"连接名",prop:"connName"},{default:l(()=>[e(p,{modelValue:t.connName,"onUpdate:modelValue":a[0]||(a[0]=n=>t.connName=n),placeholder:"连接名"},null,8,["modelValue"])]),_:1}),e(i,{prop:"dbType",label:"数据库类型"},{default:l(()=>[e(m,{modelValue:t.dbType,"onUpdate:modelValue":a[1]||(a[1]=n=>t.dbType=n),clearable:"",placeholder:"数据库类型",style:{width:"100%"},onClick:h,onChange:L,"value-key":"dbType"},{default:l(()=>[(y(!0),S(z,null,H(v.value,n=>(y(),V(q,{label:n.dbType,value:n.dbType,key:n.dbType},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"数据库URL",prop:"connUrl"},{default:l(()=>[e(p,{modelValue:t.url,"onUpdate:modelValue":a[2]||(a[2]=n=>t.url=n),placeholder:"数据库URL"},null,8,["modelValue"])]),_:1}),e(i,{label:"用户名",prop:"username"},{default:l(()=>[e(p,{modelValue:t.username,"onUpdate:modelValue":a[3]||(a[3]=n=>t.username=n),placeholder:"用户名"},null,8,["modelValue"])]),_:1}),e(i,{label:"密码",prop:"password"},{default:l(()=>[e(p,{modelValue:t.password,"onUpdate:modelValue":a[4]||(a[4]=n=>t.password=n),autocomplete:"off",type:"password",placeholder:"密码"},null,8,["modelValue"])]),_:1}),e(i,{label:"数据库",prop:"databaseName"},{default:l(()=>[e(p,{modelValue:t.databaseName,"onUpdate:modelValue":a[5]||(a[5]=n=>t.databaseName=n),placeholder:"数据库"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}},Y={__name:"index",setup(O){const d=x({dataListUrl:"/datasource/list",deleteUrl:"/datasource/delete",queryForm:{connName:"",dbType:""},database:[]}),N=b=>{M(b).then(s=>{A.success(s.message)})},U=()=>{B().then(b=>{d.database=b.data})},c=C(),g=b=>{c.value.init(b)},{getDataList:t,selectionChangeHandle:v,sizeChangeHandle:h,currentChangeHandle:L,deleteBatchHandle:k}=G(d);return(b,s)=>{const T=r("el-input"),o=r("el-form-item"),a=r("el-option"),p=r("el-select"),i=r("el-button"),q=r("el-form"),m=r("el-table-column"),D=r("el-table"),w=r("el-pagination"),F=r("el-card"),n=j("loading");return y(),V(F,null,{default:l(()=>[e(q,{inline:!0,model:d.queryForm,onKeyup:s[5]||(s[5]=R(u=>f(t)(),["enter"]))},{default:l(()=>[e(o,null,{default:l(()=>[e(T,{modelValue:d.queryForm.connName,"onUpdate:modelValue":s[0]||(s[0]=u=>d.queryForm.connName=u),placeholder:"连接名"},null,8,["modelValue"])]),_:1}),e(o,{prop:"dbType"},{default:l(()=>[e(p,{modelValue:d.queryForm.dbType,"onUpdate:modelValue":s[1]||(s[1]=u=>d.queryForm.dbType=u),onClick:U,clearable:"",placeholder:"数据库类型","value-key":"dbType"},{default:l(()=>[(y(!0),S(z,null,H(d.database,u=>(y(),V(a,{label:u.dbType,value:u.dbType,key:u.dbType},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(o,null,{default:l(()=>[e(i,{onClick:s[2]||(s[2]=u=>f(t)())},{default:l(()=>[_("查询")]),_:1})]),_:1}),e(o,null,{default:l(()=>[e(i,{type:"primary",onClick:s[3]||(s[3]=u=>g())},{default:l(()=>[_("新增")]),_:1})]),_:1}),e(o,null,{default:l(()=>[e(i,{type:"danger",onClick:s[4]||(s[4]=u=>f(k)())},{default:l(()=>[_("删除")]),_:1})]),_:1})]),_:1},8,["model"]),E((y(),V(D,{data:d.dataList,border:"",style:{width:"100%"},onSelectionChange:f(v)},{default:l(()=>[e(m,{type:"selection","header-align":"center",align:"center",width:"50"}),e(m,{prop:"connName",label:"连接名","header-align":"center",align:"center"}),e(m,{prop:"dbType",label:"数据库类型","header-align":"center",align:"center"}),e(m,{prop:"driverClassName",label:"数据库驱动","header-align":"center",align:"center"}),e(m,{prop:"url",label:"数据库URL","show-overflow-tooltip":"","header-align":"center",align:"center"}),e(m,{prop:"username",label:"用户名","header-align":"center",align:"center"}),e(m,{label:"操作",fixed:"right","header-align":"center",align:"center",width:"170"},{default:l(u=>[e(i,{type:"primary",link:"",onClick:$=>N(u.row)},{default:l(()=>[_("测试")]),_:2},1032,["onClick"]),e(i,{type:"primary",link:"",onClick:$=>g(u.row.id)},{default:l(()=>[_("编辑")]),_:2},1032,["onClick"]),e(i,{type:"primary",link:"",onClick:$=>f(k)(u.row.id)},{default:l(()=>[_("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[n,d.dataListLoading]]),e(w,{"current-page":d.page,"page-sizes":d.size,"page-size":d.limit,total:d.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:f(h),onCurrentChange:f(L)},null,8,["current-page","page-sizes","page-size","total","onSizeChange","onCurrentChange"]),e(J,{ref_key:"addOrUpdateRef",ref:c,onRefreshDataList:f(t)},null,8,["onRefreshDataList"])]),_:1})}}};export{Y as default};
