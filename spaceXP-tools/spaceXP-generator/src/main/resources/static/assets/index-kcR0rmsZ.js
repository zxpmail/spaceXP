import{r as V,a as $,b as r,o as x,c as L,w as t,d as b,e,i as F,E as q,h as I,u as c,j as H,l as R,t as A}from"./index-3XwZfhas.js";import{u as D}from"./index-9PWT6Rqf.js";import{b as E,c as P,u as B}from"./project--PYU1xUP.js";const K={__name:"add-or-update",emits:["refreshDataList"],setup(N,{expose:s,emit:i}){const y=i,g=V(!1),v=V(),o=$({id:"",artifactId:"test",groupId:"cn.piesat",version:"1.0.0",type:1,author:"zhouxiaoping",email:"zhouxiaoping@piesat.cn",description:"",port:8080}),z=p=>{g.value=!0,o.id="",v.value&&v.value.resetFields(),p&&w(p)},w=p=>{E(p).then(l=>{Object.assign(o,l.data)})},U=V({artifactId:[{required:!0,message:"必填项不能为空",trigger:"blur"}],groupId:[{required:!0,message:"必填项不能为空",trigger:"blur"}],version:[{required:!0,message:"必填项不能为空",trigger:"blur"}],type:[{required:!0,message:"必填项不能为空",trigger:"blur"}]}),h=()=>{v.value.validate(p=>{if(!p)return!1;P(o).then(()=>{q.success({message:"操作成功",duration:500,onClose:()=>{g.value=!1,y("refreshDataList")}})})})};return s({init:z}),(p,l)=>{const a=r("el-input"),d=r("el-form-item"),u=r("el-option"),k=r("el-select"),f=r("el-form"),C=r("el-button"),j=r("el-dialog");return x(),L(j,{modelValue:g.value,"onUpdate:modelValue":l[11]||(l[11]=n=>g.value=n),title:o.id?"修改":"新增","close-on-click-modal":!1},{footer:t(()=>[e(C,{onClick:l[9]||(l[9]=n=>g.value=!1)},{default:t(()=>[b("取消")]),_:1}),e(C,{type:"primary",onClick:l[10]||(l[10]=n=>h())},{default:t(()=>[b("确定")]),_:1})]),default:t(()=>[e(f,{ref_key:"dataFormRef",ref:v,model:o,rules:U.value,"label-width":"100px",onKeyup:l[8]||(l[8]=F(n=>h(),["enter"]))},{default:t(()=>[e(d,{label:"项目标识",prop:"artifactId"},{default:t(()=>[e(a,{modelValue:o.artifactId,"onUpdate:modelValue":l[0]||(l[0]=n=>o.artifactId=n),placeholder:"项目标识"},null,8,["modelValue"])]),_:1}),e(d,{label:"项目包名",prop:"groupId"},{default:t(()=>[e(a,{modelValue:o.groupId,"onUpdate:modelValue":l[1]||(l[1]=n=>o.groupId=n),placeholder:"项目包名"},null,8,["modelValue"])]),_:1}),e(d,{label:"版本号",prop:"version"},{default:t(()=>[e(a,{modelValue:o.version,"onUpdate:modelValue":l[2]||(l[2]=n=>o.version=n),placeholder:"版本号"},null,8,["modelValue"])]),_:1}),e(d,{label:"项目类型",prop:"type"},{default:t(()=>[e(k,{modelValue:o.type,"onUpdate:modelValue":l[3]||(l[3]=n=>o.type=n),clearable:"",placeholder:"项目类型",style:{width:"100%"}},{default:t(()=>[e(u,{value:1,label:"单体"}),e(u,{value:2,label:"多模块"})]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"作者",prop:"author"},{default:t(()=>[e(a,{modelValue:o.author,"onUpdate:modelValue":l[4]||(l[4]=n=>o.author=n),placeholder:"作者"},null,8,["modelValue"])]),_:1}),e(d,{label:"EMail",prop:"email"},{default:t(()=>[e(a,{modelValue:o.email,"onUpdate:modelValue":l[5]||(l[5]=n=>o.email=n),placeholder:"EMail"},null,8,["modelValue"])]),_:1}),e(d,{label:"项目端口",prop:"port"},{default:t(()=>[e(a,{modelValue:o.port,"onUpdate:modelValue":l[6]||(l[6]=n=>o.port=n),placeholder:"项目端口"},null,8,["modelValue"])]),_:1}),e(d,{label:"项目描述",prop:"port"},{default:t(()=>[e(a,{modelValue:o.description,"onUpdate:modelValue":l[7]||(l[7]=n=>o.description=n),type:"textarea",placeholder:"项目描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}},O={__name:"download",setup(N,{expose:s}){const i=$({dataListUrl:"/table/list",queryForm:{connName:""}}),y=V(!1);V();const g=V(""),v=$({project:{}}),o=l=>{y.value=!0,v.project=l,w()},z=()=>{const l=i.dataListSelections?i.dataListSelections:[];if(l.length===0){q.warning("请选择生成代码的表");return}const a=i.dataList.filter(u=>l.includes(u.id));[...new Set(a.map(u=>u.connName))].length>1?q.warning("生成代码必须保证为相同的数据源名称"):(v.project.tables=a,v.project.tablePrefix=g.value,B("generator/genProjectCode",v.project),y.value=!1)};s({init:o});const{getDataList:w,selectionChangeHandle:U,sizeChangeHandle:h,currentChangeHandle:p}=D(i);return(l,a)=>{const d=r("el-input"),u=r("el-form-item"),k=r("el-button"),f=r("el-form"),C=r("el-table-column"),j=r("el-table"),n=r("el-pagination"),S=r("el-dialog"),m=I("loading");return x(),L(S,{modelValue:y.value,"onUpdate:modelValue":a[6]||(a[6]=_=>y.value=_),title:"源码下载","close-on-click-modal":!1},{footer:t(()=>[e(k,{onClick:a[4]||(a[4]=_=>y.value=!1)},{default:t(()=>[b("取消")]),_:1}),e(k,{type:"primary",onClick:a[5]||(a[5]=_=>z())},{default:t(()=>[b("下载")]),_:1})]),default:t(()=>[e(f,{inline:!0,model:i.queryForm,onKeyup:a[3]||(a[3]=F(_=>c(w)(),["enter"]))},{default:t(()=>[e(u,null,{default:t(()=>[e(d,{modelValue:i.queryForm.connName,"onUpdate:modelValue":a[0]||(a[0]=_=>i.queryForm.connName=_),placeholder:"数据源名称"},null,8,["modelValue"])]),_:1}),e(u,null,{default:t(()=>[e(k,{onClick:a[1]||(a[1]=_=>c(w)())},{default:t(()=>[b("查询")]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(d,{modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=_=>g.value=_),placeholder:"表前缀"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),H((x(),L(j,{data:i.dataList,border:"",style:{width:"100%"},onSelectionChange:c(U)},{default:t(()=>[e(C,{type:"selection","header-align":"center",align:"center",width:"50"}),e(C,{prop:"tableName",label:"表名","header-align":"center",align:"center"}),e(C,{prop:"tableComment",label:"表说明","header-align":"center",align:"center"}),e(C,{prop:"connName",label:"数据源名称","header-align":"center",align:"center"})]),_:1},8,["data","onSelectionChange"])),[[m,i.dataListLoading]]),e(n,{"current-page":i.page,"page-sizes":i.pageSizes,"page-size":i.limit,total:i.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:c(h),onCurrentChange:c(p)},null,8,["current-page","page-sizes","page-size","total","onSizeChange","onCurrentChange"])]),_:1},8,["modelValue"])}}},J={__name:"index",setup(N){const s=$({dataListUrl:"/project/list",deleteUrl:"/project/delete",queryForm:{projectName:""}}),i=V(),y=p=>{i.value.init(p)},g=V(),v=p=>{g.value.init(p)},{getDataList:o,selectionChangeHandle:z,sizeChangeHandle:w,currentChangeHandle:U,deleteBatchHandle:h}=D(s);return(p,l)=>{const a=r("el-input"),d=r("el-form-item"),u=r("el-button"),k=r("el-form"),f=r("el-table-column"),C=r("el-table"),j=r("el-pagination"),n=r("el-card"),S=I("loading");return x(),L(n,null,{default:t(()=>[e(k,{inline:!0,model:s.queryForm,onKeyup:l[4]||(l[4]=F(m=>c(o)(),["enter"]))},{default:t(()=>[e(d,null,{default:t(()=>[e(a,{modelValue:s.queryForm.projectName,"onUpdate:modelValue":l[0]||(l[0]=m=>s.queryForm.projectName=m),placeholder:"项目名"},null,8,["modelValue"])]),_:1}),e(d,null,{default:t(()=>[e(u,{onClick:l[1]||(l[1]=m=>c(o)())},{default:t(()=>[b("查询")]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(u,{type:"primary",onClick:l[2]||(l[2]=m=>y())},{default:t(()=>[b("新增")]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(u,{type:"danger",onClick:l[3]||(l[3]=m=>c(h)())},{default:t(()=>[b("删除")]),_:1})]),_:1})]),_:1},8,["model"]),H((x(),L(C,{data:s.dataList,border:"",style:{width:"100%"},onSelectionChange:c(z)},{default:t(()=>[e(f,{type:"selection","header-align":"center",align:"center",width:"50"}),e(f,{prop:"artifactId",label:"项目标识","header-align":"center",align:"center"}),e(f,{prop:"groupId",label:"项目包名","show-overflow-tooltip":"","header-align":"center",align:"center"}),e(f,{prop:"version",label:"版本","show-overflow-tooltip":"","header-align":"center",align:"center"}),e(f,{prop:"type",label:"类型","show-overflow-tooltip":"","header-align":"center",align:"center"},{default:t(({row:m})=>[R("span",null,A(m.type===2?"多模块":"单体"),1)]),_:1}),e(f,{prop:"author",label:"作者","show-overflow-tooltip":"","header-align":"center",align:"center"}),e(f,{prop:"email",label:"Email","show-overflow-tooltip":"","header-align":"center",align:"center"}),e(f,{label:"操作",fixed:"right","header-align":"center",align:"center",width:"180"},{default:t(m=>[e(u,{type:"primary",link:"",onClick:_=>y(m.row.id)},{default:t(()=>[b("修改")]),_:2},1032,["onClick"]),e(u,{type:"primary",link:"",onClick:_=>v(m.row)},{default:t(()=>[b("源码下载")]),_:2},1032,["onClick"]),e(u,{type:"primary",link:"",onClick:_=>c(h)(m.row.id)},{default:t(()=>[b("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[S,s.dataListLoading]]),e(j,{"current-page":s.page,"page-sizes":s.pageSizes,"page-size":s.size,total:s.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:c(w),onCurrentChange:c(U)},null,8,["current-page","page-sizes","page-size","total","onSizeChange","onCurrentChange"]),e(K,{ref_key:"addOrUpdateRef",ref:i,onRefreshDataList:c(o)},null,8,["onRefreshDataList"]),e(O,{ref_key:"downloadRef",ref:g},null,512)]),_:1})}}};export{J as default};
