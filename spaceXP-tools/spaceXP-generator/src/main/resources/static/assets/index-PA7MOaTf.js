import{r as y,a as S,b as o,o as k,c as D,w as a,d as _,e,i as U,E as x,h as F,j as R,u as v}from"./index-ppLWERmU.js";import{u as T}from"./index-DLQuwbiU.js";import{u as $,a as h}from"./database-TPVBUrqz.js";const H={__name:"add-or-update",emits:["refreshDataList"],setup(w,{expose:p,emit:g}){const V=g,i=y(!1),u=y(),t=S({id:"",dbType:"",driverClassName:"",url:"",tableFields:"",tableSql:"",addDatabaseName:0}),C=d=>{i.value=!0,t.id="",u.value&&u.value.resetFields(),d&&c(d)},c=d=>{$(d).then(l=>{Object.assign(t,l.data)})},b=y({dbType:[{required:!0,message:"必填项不能为空",trigger:"blur"}],driverClassName:[{required:!0,message:"必填项不能为空",trigger:"blur"}],url:[{required:!0,message:"必填项不能为空",trigger:"blur"}],tableName:[{required:!0,message:"必填项不能为空",trigger:"blur"}],tableComment:[{required:!0,message:"必填项不能为空",trigger:"blur"}],fieldName:[{required:!0,message:"必填项不能为空",trigger:"blur"}],fieldType:[{required:!0,message:"必填项不能为空",trigger:"blur"}],tableFields:[{required:!0,message:"必填项不能为空",trigger:"blur"}],fieldComment:[{required:!0,message:"必填项不能为空",trigger:"blur"}],fieldKey:[{required:!0,message:"必填项不能为空",trigger:"blur"}],tableSql:[{required:!0,message:"必填项不能为空",trigger:"blur"}],tableNameSql:[{required:!0,message:"必填项不能为空",trigger:"blur"}]}),f=()=>{u.value.validate(d=>{if(!d)return!1;h({...t}).then(()=>{x.success({message:"操作成功",duration:500,onClose:()=>{i.value=!1,V("refreshDataList")}})})})};return p({init:C}),(d,l)=>{const n=o("el-input"),s=o("el-form-item"),q=o("el-switch"),L=o("el-form"),m=o("el-button"),N=o("el-dialog");return k(),D(N,{modelValue:i.value,"onUpdate:modelValue":l[9]||(l[9]=r=>i.value=r),title:t.id?"修改":"新增","close-on-click-modal":!1},{footer:a(()=>[e(m,{onClick:l[7]||(l[7]=r=>i.value=!1)},{default:a(()=>[_("取消")]),_:1}),e(m,{type:"primary",onClick:l[8]||(l[8]=r=>f())},{default:a(()=>[_("确定")]),_:1})]),default:a(()=>[e(L,{ref_key:"dataFormRef",ref:u,model:t,rules:b.value,"label-width":"120px",onKeyup:l[6]||(l[6]=U(r=>f(),["enter"]))},{default:a(()=>[e(s,{label:"数据库类型",prop:"dbType"},{default:a(()=>[e(n,{modelValue:t.dbType,"onUpdate:modelValue":l[0]||(l[0]=r=>t.dbType=r),placeholder:"数据库类型"},null,8,["modelValue"])]),_:1}),e(s,{label:"数据库驱动",prop:"driver"},{default:a(()=>[e(n,{modelValue:t.driverClassName,"onUpdate:modelValue":l[1]||(l[1]=r=>t.driverClassName=r),placeholder:"数据库驱动"},null,8,["modelValue"])]),_:1}),e(s,{label:"数据库URL",prop:"url"},{default:a(()=>[e(n,{modelValue:t.url,"onUpdate:modelValue":l[2]||(l[2]=r=>t.url=r),placeholder:"数据库URL"},null,8,["modelValue"])]),_:1}),e(s,{label:"字段信息SQL",prop:"tableFields"},{default:a(()=>[e(n,{type:"textarea",autosize:"",modelValue:t.tableFields,"onUpdate:modelValue":l[3]||(l[3]=r=>t.tableFields=r),placeholder:"字段信息SQL"},null,8,["modelValue"])]),_:1}),e(s,{label:"表信息SQL",prop:"tableSql"},{default:a(()=>[e(n,{type:"textarea",autosize:"",modelValue:t.tableSql,"onUpdate:modelValue":l[4]||(l[4]=r=>t.tableSql=r),placeholder:"表信息SQL"},null,8,["modelValue"])]),_:1}),e(s,{label:"拼接数据库",prop:"addDatabaseName"},{default:a(()=>[e(q,{"active-value":1,"inactive-value":0,modelValue:t.addDatabaseName,"onUpdate:modelValue":l[5]||(l[5]=r=>t.addDatabaseName=r),"inline-prompt":"","active-text":"Y","inactive-text":"N"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}},j={__name:"index",setup(w){const p=S({dataListUrl:"/database/list",deleteUrl:"/database/delete",isPage:!1}),g=y(),V=()=>{g.value.init()},i=c=>{g.value.init(c)},{getDataList:u,selectionChangeHandle:t,deleteHandle:C}=T(p);return(c,b)=>{const f=o("el-button"),d=o("el-form-item"),l=o("el-form"),n=o("el-table-column"),s=o("el-table"),q=o("el-card"),L=F("loading");return k(),D(q,null,{default:a(()=>[e(l,{inline:!0,model:p.queryForm,onKeyup:b[1]||(b[1]=U(m=>v(u)(),["enter"]))},{default:a(()=>[e(d,null,{default:a(()=>[e(f,{type:"primary",onClick:b[0]||(b[0]=m=>V())},{default:a(()=>[_("新增")]),_:1})]),_:1})]),_:1},8,["model"]),R((k(),D(s,{data:p.dataList,border:"",style:{width:"100%"},onSelectionChange:v(t)},{default:a(()=>[e(n,{prop:"dbType",label:"数据库类型","header-align":"center",align:"center"}),e(n,{prop:"driverClassName",label:"数据库驱动","header-align":"center",align:"center"}),e(n,{prop:"url",label:"数据库URL","show-overflow-tooltip":"","header-align":"center",align:"center"}),e(n,{label:"操作",fixed:"right","header-align":"center",align:"center",width:"170"},{default:a(m=>[e(f,{type:"primary",link:"",onClick:N=>i(m.row.id)},{default:a(()=>[_("编辑")]),_:2},1032,["onClick"]),e(f,{type:"primary",link:"",onClick:N=>v(C)(m.row.id)},{default:a(()=>[_("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[L,p.dataListLoading]]),e(H,{ref_key:"addOrUpdateRef",ref:g,onRefreshDataList:v(u)},null,8,["onRefreshDataList"])]),_:1})}}};export{j as default};
