import{r as V,a as L,b as r,o as S,c as x,w as t,d as b,e,j as F,E as $,i as I,u as m,k as A}from"./index-iopgyiET.js";import{u as H}from"./index-TJzWGCe4.js";import{c as R,d as O,u as D}from"./project-sY47MFUY.js";const E={__name:"add-or-update",emits:["refreshDataList"],setup(q,{expose:s,emit:d}){const C=d,c=V(!1),_=V(),o=L({id:"",artifactId:"test",groupId:"cn.piesat",version:"1.0.0",type:"单体",author:"zhouxiaoping",email:"zhouxiaoping@piesat.cn",description:"",port:8080}),z=p=>{c.value=!0,o.id="",_.value&&_.value.resetFields(),p&&w(p)},w=p=>{R(p).then(l=>{Object.assign(o,l.data)})},U=V({artifactId:[{required:!0,message:"必填项不能为空",trigger:"blur"}],groupId:[{required:!0,message:"必填项不能为空",trigger:"blur"}],version:[{required:!0,message:"必填项不能为空",trigger:"blur"}],type:[{required:!0,message:"必填项不能为空",trigger:"blur"}]}),h=()=>{_.value.validate(p=>{if(!p)return!1;O(o).then(()=>{$.success({message:"操作成功",duration:500,onClose:()=>{c.value=!1,C("refreshDataList")}})})})};return s({init:z}),(p,l)=>{const a=r("el-input"),u=r("el-form-item"),i=r("el-option"),k=r("el-select"),g=r("el-form"),y=r("el-button"),j=r("el-dialog");return S(),x(j,{modelValue:c.value,"onUpdate:modelValue":l[11]||(l[11]=n=>c.value=n),title:o.id?"修改":"新增","close-on-click-modal":!1},{footer:t(()=>[e(y,{onClick:l[9]||(l[9]=n=>c.value=!1)},{default:t(()=>[b("取消")]),_:1}),e(y,{type:"primary",onClick:l[10]||(l[10]=n=>h())},{default:t(()=>[b("确定")]),_:1})]),default:t(()=>[e(g,{ref_key:"dataFormRef",ref:_,model:o,rules:U.value,"label-width":"100px",onKeyup:l[8]||(l[8]=F(n=>h(),["enter"]))},{default:t(()=>[e(u,{label:"项目标识",prop:"artifactId"},{default:t(()=>[e(a,{modelValue:o.artifactId,"onUpdate:modelValue":l[0]||(l[0]=n=>o.artifactId=n),placeholder:"项目标识"},null,8,["modelValue"])]),_:1}),e(u,{label:"项目包名",prop:"groupId"},{default:t(()=>[e(a,{modelValue:o.groupId,"onUpdate:modelValue":l[1]||(l[1]=n=>o.groupId=n),placeholder:"项目包名"},null,8,["modelValue"])]),_:1}),e(u,{label:"版本号",prop:"version"},{default:t(()=>[e(a,{modelValue:o.version,"onUpdate:modelValue":l[2]||(l[2]=n=>o.version=n),placeholder:"版本号"},null,8,["modelValue"])]),_:1}),e(u,{label:"项目类型",prop:"type"},{default:t(()=>[e(k,{modelValue:o.type,"onUpdate:modelValue":l[3]||(l[3]=n=>o.type=n),clearable:"",placeholder:"项目类型",style:{width:"100%"}},{default:t(()=>[e(i,{value:"单体",label:"单体"}),e(i,{value:"EUREKA",label:"EUREKA"}),e(i,{value:"NACOS",label:"NACOS"}),e(i,{value:"NACOS CONFIG",label:"NACOS CONFIG"}),e(i,{value:"代码",label:"代码"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"作者",prop:"author"},{default:t(()=>[e(a,{modelValue:o.author,"onUpdate:modelValue":l[4]||(l[4]=n=>o.author=n),placeholder:"作者"},null,8,["modelValue"])]),_:1}),e(u,{label:"EMail",prop:"email"},{default:t(()=>[e(a,{modelValue:o.email,"onUpdate:modelValue":l[5]||(l[5]=n=>o.email=n),placeholder:"EMail"},null,8,["modelValue"])]),_:1}),e(u,{label:"项目端口",prop:"port"},{default:t(()=>[e(a,{modelValue:o.port,"onUpdate:modelValue":l[6]||(l[6]=n=>o.port=n),placeholder:"项目端口"},null,8,["modelValue"])]),_:1}),e(u,{label:"项目描述",prop:"port"},{default:t(()=>[e(a,{modelValue:o.description,"onUpdate:modelValue":l[7]||(l[7]=n=>o.description=n),type:"textarea",placeholder:"项目描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}},K={__name:"download",setup(q,{expose:s}){const d=L({dataListUrl:"/table/list",queryForm:{connName:""}}),C=V(!1);V();const c=V(""),_=L({project:{}}),o=l=>{C.value=!0,_.project=l,w()},z=()=>{const l=d.dataListSelections?d.dataListSelections:[];if(l.length===0){$.warning("请选择生成代码的表");return}const a=d.dataList.filter(i=>l.includes(i.id));if(Array.from(new Set(a.map(({datasourceName:i})=>i))).length>1){$.warning("生成代码必须保证为相同的数据源名称");return}_.project.tables=a,_.project.tablePrefix=c.value,D("generator/genProjectCode",_.project),C.value=!1};s({init:o});const{getDataList:w,selectionChangeHandle:U,sizeChangeHandle:h,currentChangeHandle:p}=H(d);return(l,a)=>{const u=r("el-input"),i=r("el-form-item"),k=r("el-button"),g=r("el-form"),y=r("el-table-column"),j=r("el-table"),n=r("el-pagination"),N=r("el-dialog"),v=I("loading");return S(),x(N,{modelValue:C.value,"onUpdate:modelValue":a[6]||(a[6]=f=>C.value=f),title:"源码下载","close-on-click-modal":!1},{footer:t(()=>[e(k,{onClick:a[4]||(a[4]=f=>C.value=!1)},{default:t(()=>[b("取消")]),_:1}),e(k,{type:"primary",onClick:a[5]||(a[5]=f=>z())},{default:t(()=>[b("下载")]),_:1})]),default:t(()=>[e(g,{inline:!0,model:d.queryForm,onKeyup:a[3]||(a[3]=F(f=>m(w)(),["enter"]))},{default:t(()=>[e(i,null,{default:t(()=>[e(u,{modelValue:d.queryForm.connName,"onUpdate:modelValue":a[0]||(a[0]=f=>d.queryForm.connName=f),placeholder:"数据源名称"},null,8,["modelValue"])]),_:1}),e(i,null,{default:t(()=>[e(k,{onClick:a[1]||(a[1]=f=>m(w)())},{default:t(()=>[b("查询")]),_:1})]),_:1}),e(i,null,{default:t(()=>[e(u,{modelValue:c.value,"onUpdate:modelValue":a[2]||(a[2]=f=>c.value=f),placeholder:"下载表名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),A((S(),x(j,{data:d.dataList,border:"",style:{width:"100%"},onSelectionChange:m(U)},{default:t(()=>[e(y,{type:"selection","header-align":"center",align:"center",width:"50"}),e(y,{prop:"tableName",label:"表名","header-align":"center",align:"center"}),e(y,{prop:"tableComment",label:"表说明","header-align":"center",align:"center"}),e(y,{prop:"connName",label:"数据源名称","header-align":"center",align:"center"})]),_:1},8,["data","onSelectionChange"])),[[v,d.dataListLoading]]),e(n,{"current-page":d.page,"page-sizes":d.pageSizes,"page-size":d.limit,total:d.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:m(h),onCurrentChange:m(p)},null,8,["current-page","page-sizes","page-size","total","onSizeChange","onCurrentChange"])]),_:1},8,["modelValue"])}}},G={__name:"index",setup(q){const s=L({dataListUrl:"/project/list",deleteUrl:"/project/delete",queryForm:{projectName:""}}),d=V(),C=p=>{d.value.init(p)},c=V(),_=p=>{c.value.init(p)},{getDataList:o,selectionChangeHandle:z,sizeChangeHandle:w,currentChangeHandle:U,deleteBatchHandle:h}=H(s);return(p,l)=>{const a=r("el-input"),u=r("el-form-item"),i=r("el-button"),k=r("el-form"),g=r("el-table-column"),y=r("el-table"),j=r("el-pagination"),n=r("el-card"),N=I("loading");return S(),x(n,null,{default:t(()=>[e(k,{inline:!0,model:s.queryForm,onKeyup:l[4]||(l[4]=F(v=>m(o)(),["enter"]))},{default:t(()=>[e(u,null,{default:t(()=>[e(a,{modelValue:s.queryForm.projectName,"onUpdate:modelValue":l[0]||(l[0]=v=>s.queryForm.projectName=v),placeholder:"项目名"},null,8,["modelValue"])]),_:1}),e(u,null,{default:t(()=>[e(i,{onClick:l[1]||(l[1]=v=>m(o)())},{default:t(()=>[b("查询")]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(i,{type:"primary",onClick:l[2]||(l[2]=v=>C())},{default:t(()=>[b("新增")]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(i,{type:"danger",onClick:l[3]||(l[3]=v=>m(h)())},{default:t(()=>[b("删除")]),_:1})]),_:1})]),_:1},8,["model"]),A((S(),x(y,{data:s.dataList,border:"",style:{width:"100%"},onSelectionChange:m(z)},{default:t(()=>[e(g,{type:"selection","header-align":"center",align:"center",width:"50"}),e(g,{prop:"artifactId",label:"项目标识","header-align":"center",align:"center"}),e(g,{prop:"groupId",label:"项目包名","show-overflow-tooltip":"","header-align":"center",align:"center"}),e(g,{prop:"version",label:"版本","show-overflow-tooltip":"","header-align":"center",align:"center"}),e(g,{prop:"type",label:"类型","show-overflow-tooltip":"","header-align":"center",align:"center"}),e(g,{prop:"author",label:"作者","show-overflow-tooltip":"","header-align":"center",align:"center"}),e(g,{prop:"email",label:"Email","show-overflow-tooltip":"","header-align":"center",align:"center"}),e(g,{label:"操作",fixed:"right","header-align":"center",align:"center",width:"180"},{default:t(v=>[e(i,{type:"primary",link:"",onClick:f=>C(v.row.id)},{default:t(()=>[b("修改")]),_:2},1032,["onClick"]),e(i,{type:"primary",link:"",onClick:f=>_(v.row)},{default:t(()=>[b("源码下载")]),_:2},1032,["onClick"]),e(i,{type:"primary",link:"",onClick:f=>m(h)(v.row.id)},{default:t(()=>[b("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[N,s.dataListLoading]]),e(j,{"current-page":s.page,"page-sizes":s.pageSizes,"page-size":s.size,total:s.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:m(w),onCurrentChange:m(U)},null,8,["current-page","page-sizes","page-size","total","onSizeChange","onCurrentChange"]),e(E,{ref_key:"addOrUpdateRef",ref:d,onRefreshDataList:m(o)},null,8,["onRefreshDataList"]),e(K,{ref_key:"downloadRef",ref:c},null,512)]),_:1})}}};export{G as default};
